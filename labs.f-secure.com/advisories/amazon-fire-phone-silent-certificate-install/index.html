<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Amazon Fire Phone Silent Certificate Install</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/amazon-fire-phone-silent-certificate-install/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/amazon-fire-phone-silent-certificate-install/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/amazon-fire-phone-silent-certificate-install/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Amazon Fire Phone Silent Certificate Install</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Amazon Fire Phone</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>N/A</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Amazon Fire Phone – Silent Certificate Install</td>
          </tr>
        </table>
        
        <p>A vulnerability was discovered within the modified Amazon Fire Phones CertInstaller package which would enable applications to install certificates without user interaction. Once an application has installed malicious certificates, an attacker would be able to perform Man-in-the-middle (<span class="caps">MITM</span>) attacks against encrypted traffic.</p>
<p>The advisory can be downloaded <a href="system/assets/993/original/mwri_fire_phone_silent_cert_install.pdf">here</a>.</p>
<h3>Description</h3>
<p>The CertInstaller package on the Amazon Fire Phone allows applications to install certificates without interaction with the user. Although the application’s name is identical to the base Android package, the source code has been modified specifically for the Amazon Fire Phone. Successful exploitation of the vulnerability would allow an attacker to Man-in-the-Middle (MiTM) encrypted traffic. Although no user interaction is required, a notification is sent when a certificate has been installed.</p>
<h3>Impact</h3>
<p>If the vulnerability was to be successfully exploited, all encrypted traffic that does not make use of certificate pinning could be intercepted with a Man-in-The-Middle attack.</p>
<h3>Cause</h3>
<p>The package checks for an extra that, if set, results in the silent installation of a certificate.</p>
<h3>Interim Workaround</h3>
<p>Users are advised to only install applications from trusted sources and exclusively make use of trusted networks. Users that notice any notifications regarding “Certificate Installed” should immediately remove the certificate and uninstall any possibly malicious applications that were recently added.</p>
<h3>Solution</h3>
<p>Users should update to the latest version of Fire OS, as the issue has been addressed in Fire OS 4.6.1.</p>
<h3>Technical Details</h3>
<p>The onCreate method of the CertInstaller activity is given below:</p>
<pre>protected void onCreate(Bundle savedStates) {
        super.onCreate(savedStates);
        this.mCredentials = createCredentialHelper(getIntent());
        if (this.mCredentials.installSilently() || UserHandle.myUserId() == 0) {
            this.mState = savedStates == null ? 1 : 2;
            if (this.mState != 1) {
                this.mCredentials.onRestoreStates(savedStates);
                this.mNextAction = (MyAction) savedStates.getSerializable(NEXT_ACTION_KEY);
            } else if (!this.mCredentials.containsAnyRawData()) {
                showErrorDialogAndFinish(R.id.activity_text);
            } else if (!this.mCredentials.hasPkcs12KeyStore()) {
                MyAction action = new InstallOthersAction();
                if (needsKeyStoreAccess()) {
                    sendUnlockKeyStoreIntent();
                    this.mNextAction = action;
                } else {
                    action.run(this);
                }
            } else if (this.mCredentials.hasScepPassword()) {
                this.mNextAction = new Pkcs12ExtractAction(this.mCredentials.getScepPassword());
                this.mNextAction.run(this);
            } else if (this.mCredentials.installSilently()) {
                Log.e(TAG, "Installing silently? Pkcs password missing! Aborting...");
                finish();
            } else {
                showDialog(STATE_RUNNING);
            }
        } else {
            showErrorDialogAndFinish(R.string.only_primary_user_allowed);
        }
    }</pre>
<p>The following line is where the vulnerability exists:</p>
<pre>if (this.mCredentials.installSilently() || UserHandle.myUserId() == 0) {</pre>
<p>The logic trace of installSilently() method is given below:</p>
<pre>    CredentialHelper(Intent intent) {
        this.mBundle = new HashMap();
        this.mName = "";
        this.mCaCerts = new ArrayList();
        Bundle bundle = intent.getExtras();
        if (bundle != null) {
            String name = bundle.getString("name");
            bundle.remove("name");
            if (name != null) {
                this.mName = name;
            }
            String scepPassword = bundle.getString(EXTRA_SCEP_CLIENT_PASSWORD);
            bundle.remove(EXTRA_SCEP_CLIENT_PASSWORD);
            if (scepPassword != null) {
                this.mScepPassword = scepPassword;
            }
            this.mInstallSilently = bundle.getBoolean("q_install");
            bundle.remove("q_install");
            Log.d(TAG, "# extras: " + bundle.size());
            Iterator i$ = bundle.keySet().iterator();
            while (i$.hasNext()) {
                String key = (String) i$.next();
                byte[] bytes = bundle.getByteArray(key);
                Log.d(TAG, "   " + key + ": " + (bytes == null ? -1 : bytes.length));
                this.mBundle.put(key, bytes);
            }
            parseCert(getData("CERT"));
        }
    }

    boolean installSilently() {
        return this.mInstallSilently;
    }</pre>
<p>As can be seen from the above source code, if an Intent containing the extra q_install (with its value set to true) starts the activity, the certificate will be installed silently.</p>
<h3>Detailed Timeline</h3>
<table><tbody><tr><td>Date</td>
<td>Summary</td>
</tr><tr><td>19/01/2015</td>
<td>Reported to Amazon</td>
</tr><tr><td>04/02/2015</td>
<td>Amazon confirms reception and validity</td>
</tr><tr><td>09/03/2015</td>
<td><span class="caps">MWR</span> requests status and progress</td>
</tr><tr><td>13/03/2015</td>
<td>Amazon notifies <span class="caps">MWR</span> that implementation of fixes has commenced</td>
</tr><tr><td>27/03/2015</td>
<td>Amazon notifies <span class="caps">MWR</span> that testing of fixes have commenced</td>
</tr><tr><td>10/04/2015</td>
<td>Amazon notifies <span class="caps">MWR</span> that testing is almost complete</td>
</tr><tr><td>01/05/2015</td>
<td>FireOS 4.6.1 released</td>
</tr><tr><td>03/05/2015</td>
<td>Amazon and <span class="caps">MWR</span> coordinate public release of advisory</td>
</tr><tr><td>25/06/2015</td>
<td>Advisory published</td>
</tr></tbody></table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/amazon-fire-phone-silent-certificate-install/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/amazon-fire-phone-silent-certificate-install/&text=Amazon Fire Phone Silent Certificate Install" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/amazon-fire-phone-silent-certificate-install/&title=Amazon Fire Phone Silent Certificate Install" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/993/original/mwri_fire_phone_silent_cert_install.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/amazon-fire-phone-silent-certificate-install/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
