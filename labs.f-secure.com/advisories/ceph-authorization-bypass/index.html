<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Ceph Authorization Bypass</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/ceph-authorization-bypass/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/ceph-authorization-bypass/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/ceph-authorization-bypass/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Ceph Authorization Bypass</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Ceph</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>Medium</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2020-10736</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Privilege Escalation</td>
          </tr>
        </table>
        
        <h2>Background</h2><p>The Ceph Storage Cluster is an open source project based around the Reliable Autonomic Distributed Object Store (RADOS), which provides object, block, and file system storage in a single unified storage cluster. It is a popular way of adding reliable containter-attached storage to computing environments such as Kubernetes and OpenStack and is also used in high-performance computing (HPC) clusters.</p><p>Ceph is maintained by the <a title="Ceph Foundation" href="https://ceph.io/foundation/">Ceph Foundation</a>, with contributions from members such as Red Hat, Intel, Suse, Samsung and Digital Ocean. Red Hat also provides Ceph a <a title="supported product offering" href="https://www.redhat.com/en/technologies/storage/ceph">supported product offering</a>.</p><p>Ceph implements its own network security protocol dubbed Cephx that is used to authenticate nodes within the Ceph cluster, as well as clients that wish to access Ceph storage. Cephx is almost exclusively used with shared symmetric secrets and provides a central service that mints "tickets" containing "capabilities" that are used when authenticating to services, not unlike Kerberos.</p><h2>Description</h2><p>F-Secure consultants discovered a number of missing or misplaced authorization checks where a cluster service failed to verify the "capabilities" of the authenticated user before performing some administrative action. The vulnerabilities were reported to the Ceph project for remediation and have been assigned the identifier CVE-2020-10736.</p><p>These vulnerabilities can be used by an attacker who has gained access to the authentication secret of any Ceph cluster user (including a storage client, such as a docker container) to change the runtime configuration of the central "monitor" and "manager" cluster services.</p><h2>Remediation</h2><p>The vulnerabilities were introduced in version 15.1.0 of Ceph and any previous version (such as 14.x) does not exhibit these vulnerabilities. The Ceph project has fixed these issues in the 15.2.2 release and all users of Ceph codename "Octopus" (15.x) are encouraged to update as soon as possible to the latest minor release version.</p><p>Access to the "Manager" service is not needed to access Ceph cluster storage. F-Secure recommends that users of Ceph limit network access to the "Manager" daemon to only allow administrators and Ceph cluster nodes.   </p><h2>Technical Details     </h2><h3>Multiple authorization bypass issues (CVE-2020-10736)</h3><p>In the "Monitor" service, a "kludge" was added for older clients that allows any authenticated user access to three whitelisted administrative commands. An attacker with "mon" capabilities can exploit this issue to change configuration parameters of the running mon daemon by using the "injectargs" command.</p><p>In the "Manager" service, incoming administrative messages are accepted before access checks are performed if the "fsid" parameter is present. This parameter is usually present in such messages, so this flaw can be exploited by any authenticated user to run any "MCommand" including "config set", without needing manager capabilities.</p><h2>Exploitation</h2><p>The issue in "Manager" can be exploited by using unmodified Ceph client binaries that are likely already present on many systems that use Ceph for storage, while the issue in "Monitor" requires a slight modification of the ceph client libraries (or possibly use of an unmodified older version) to trigger the faulty access check.</p><p>In both cases, network clients must first complete successful authentication to the Ceph cluster before being able to perform these attacks.</p><h2>Credit</h2><p>The issues were discovered by Olle Segerdahl (<a title="Twitter" href="https://twitter.com/nxsolle" target="_blank">@nxsolle</a>) of F-Secure Labs and F-Secure Consulting.</p><h2>Disclosure timeline</h2><table><tbody><tr><td>2020-04-17</td>
<td>F-Secure reports the vulnerabilities to the Ceph security mailing list.</td>
</tr><tr><td> 2020-04-17</td>
<td> Red Hat Product Security team acknowledges receipt and assigns ticket.</td>
</tr><tr><td> 2020-04-20</td>
<td> Red Hat Product Security requests information about any embargoes or planned disclosure dates.</td>
</tr><tr><td> 2020-05-04</td>
<td> F-Secure requests an update on progress.</td>
</tr><tr><td> 2020-05-04</td>
<td> Red Hat Product Security updates F-Secure on ticket status.</td>
</tr><tr><td>2020-05-08</td>
<td>Red Hat Product Security shares patches with F-Secure and informs that they will be included in release 15.2.2.</td>
</tr><tr><td>2020-05-14</td>
<td>Red Hat Product Security coordinates release date of 2020-05-18.</td>
</tr><tr><td>2020-05-18</td>
<td>Ceph release v15.2.2 is published.</td>
</tr><tr><td>2020-05-19</td>
<td>F-Secure publishes this advisory.</td>
</tr></tbody></table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/ceph-authorization-bypass/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/ceph-authorization-bypass/&text=Ceph Authorization Bypass" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/ceph-authorization-bypass/&title=Ceph Authorization Bypass" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/ceph-authorization-bypass/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
