<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Samsung S5 Arbitary File Retrieval during SBeam Transfer</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Samsung S5 Arbitary File Retrieval during SBeam Transfer</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Samsung S5</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>Low</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2015-4033</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Arbitrary File Retrieval during SBeam Transfer</td>
          </tr>
        </table>
        
        <p>A vulnerability was discovered within the Samsung S5 SBeam file transfer process which allowed the retrieval of arbitrary files from the phone’s filesystem while the SBeam transfer was taking place.</p>
<p>The advisory can be downloaded <a href="system/assets/1011/original/mwri_advisory_s5_arbitary_file_retrieval_during_sbeam_transfer.pdf">here</a>.</p>
<h3>Description</h3>
<p>The DirectShareManager application is used when transferring files between two Samsung devices using the SBeam feature. A vulnerability was found whereby both devices would start an <span class="caps">HTTP</span> server from the root of the filesystem on all interfaces for the duration of the transfer. If the attacker could access this service and knew the name of the file, they could retrieve the file without authentication or user interaction.</p>
<h3>Impact</h3>
<p>An attacker who was sending the victim a file via SBeam, or was on the same network as the victim during the use of SBeam can retrieve any media from the external storage (e.g. the SD card) of the victim as long as they knew the file name.</p>
<h3>Cause</h3>
<p>It was possible to download any file from the phone’s filesystem for which the full path is known and the DirectShareManager application has read permission. This was due to the launching of an unauthenticated <span class="caps">HTTP</span> server listening on all interfaces during the SBeam transfer process.</p>
<h3>Interim Workaround</h3>
<p>The SBeam application should not be used to transfer images with untrusted sources or whilst connected to untrusted networks.</p>
<h3>Solution</h3>
<p>Upgrade to the latest version via an <span class="caps">OTA</span> (over the air) update.</p>
<h3>Technical Details</h3>
<p>Users can share files using the SBeam feature by opening the file and then putting their phone against another Samsung phone. The process begins over <span class="caps">NFC</span> whereby the receiver is given credentials for a peer to peer (p2p) Wi-Fi network which is then used to securely transfer data between the two devices. Once this network has been established, both the sender and receiver start an <span class="caps">HTTP</span> service on <span class="caps">TCP</span> port 15000 on every interface</p>
<p>This <span class="caps">HTTP</span> service is used by the requesting device to retrieve the file using the path they have been given during the initial SBeam setup. However the web server allows access to any file that the DirectShareManager application has permission to read, which includes all media on the external storage. Further, both devices start the service, which means that even though a user was intending to only receive a file from another person, the other person is free to retrieve files from their device too.</p>
<p>The web server runs from the root directory, but does not allow directory listings. This means that the attacker must know the exact path and file name of the file that they wish to retrieve. Photos taken on the device are saved using a filename that is based on a timestamp in the following format:</p>
<pre>/sdcard/DCIM/camera/yyyymmdd_hhmmss.jpg</pre>
<p>It is therefore possible to try every possible filename in a brute force attack. However an easier method is to query the image cache of the gallery app found here:</p>
<pre>http://"+probableOtherDevice+":15000/sdcard/Android/data/com.sec.android.gallery3d/cache/imgcacheMicro.0</pre>
<p>This means that if the image has been viewed by the gallery app, then the exact filename can be discerned from this cache file, and then requested from the web server.</p>
<p>The DirectShareManager application code responsible for starting the web service on all interfaces serving from the root directory is shown below:</p>
<pre>./com/sec/android/directshare/DirectShareService.java

 private boolean StartWebServer(String arg9) {
        boolean v0_1;
        try {
            if(this.mHttpServerThread != null) {
                goto label_30;
            }

            this.fileScan();
            this.mHttpServerThread = new RequestListenerThread(this, this, arg9, 15000, "/", null);
            this.mHttpServerThread.setDaemon(true);
            this.mHttpServerThread.start();
            v0_1 = true;
            goto label_18;
        }
        catch(Exception v0) {
            Log.e("[SBeam]", "DirectShareService: StartWebServer: errmsg=[" + v0.getMessage() + "]");
        }

    label_30:
        v0_1 = false;
    label_18:
        return v0_1;
    }</pre>
<h3>Detailed Timeline</h3>
<table><tbody><tr><td>Date</td>
<td>Summary</td>
</tr><tr><td>12/11/2014</td>
<td>Issue disclosed to <span class="caps">ZDI</span> at Mobile Pwn2Own</td>
</tr><tr><td>12/11/2014</td>
<td><span class="caps">ZDI</span> informed Samsung of the issue</td>
</tr><tr><td>06/05/2015</td>
<td><span class="caps">MWR</span> request update from <span class="caps">ZDI</span></td>
</tr><tr><td>22/05/2015</td>
<td>Samsung respond to <span class="caps">ZDI</span>, requesting another 60 days to complete roll out of new application to users</td>
</tr><tr><td>24/06/2015</td>
<td><span class="caps">ZDI</span> release advisory</td>
</tr><tr><td>23/07/2015</td>
<td>Advisory released</td>
</tr></tbody></table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/&text=Samsung S5 Arbitary File Retrieval during SBeam Transfer" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/&title=Samsung S5 Arbitary File Retrieval during SBeam Transfer" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/1011/original/mwri_advisory_s5_arbitary_file_retrieval_during_sbeam_transfer.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/samsung-s5-arbitary-file-retrieval-during-sbeam-transfer/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
