<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>KeyWe Smart Lock unauthorized access and traffic interception</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type">Advisories</span>
      <h1>KeyWe Smart Lock unauthorized access and traffic interception</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>KeyWe Smart Lock</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>Medium</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td></td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Design Flaws</td>
          </tr>
        </table>
        
        <h3>Introduction</h3><p>The KeyWe smart lock suffers from multiple design flaws resulting in an unauthenticated - potentially malicious - actor being able to intercept and decrypt traffic coming from a legitimate user. This traffic - as described below - can then be used to execute actions (such as opening/closing the lock, denial of service, silencing the lock etc.) on behalf of the owner. </p><p>An attacker could exploit this vulnerability by intercepting any legitimate communications to steal the key and unlock the door at any point remotely.</p><p>Communication messages between a legitimate application and the lock are transported using Bluetooth Low Energy. Before sending they are encrypted using AES-128-ECB with a random 2B (two-byte) prefix (functioning as a replacement for an Initialization Vector) thus disallowing a third party to easily eavesdrop and tamper with commands originating from the legitimate parties. The key generation process is, however, affected by a serious flaw.<br><br>Security of the messaging channel currently used by KeyWe relies on two factors:</p><ol><li>the common key used to initiate the key exchange</li>
<li>the app/lock (door) key calculation process</li>
</ol><p>F-Secure has proven that both of those constraints can be overcome. Firstly - the common key is created based on the device bluetooth MAC address available globally, making it trivial to decrypt the first stage of the negotiation. Secondly, the key generation process can be retrieved from the mobile application.</p><p>It should be noted that the application utilises obfuscation and root detection to protect users from threats targeting their devices. The whole solution, however, can be targeted by a determined attacker that can - and will - overcome such protections regardless of their number and/or quality.</p><p>A technical blog post detailing this vulnerability and other features of the lock has been published <a href="blog/digital-lockpicking-stealing-keys-to-the-kingdom">here</a>.</p><h3>Communication</h3><p>Before using the lock, a device ought to be registered. The registration process consists of three phases:</p><ul><li>phase 1: setting the lock mode in order to check whether registration is needed</li>
<li>phase 2: registering a password for the device - later on referred to as EKEY</li>
<li>phase 3: verifying the EKEY value (authentication and authorisation)</li>
</ul><p>Once the device successfully passes the authentication/authorisation step, additional operations - such as opening the lock, closing etc. - are allowed. Each of the aforementioned phases consists of several additional steps.<br><br>First, a common key - based on the device Bluetooth address - is calculated. Each side uses the calculated key - later referred to as comm - to encrypt an arbitrary 12B (twelve-byte) value that is then sent to the other side, as shown below:</p><pre>           app num<br>app --[comm(12B value)]-&gt; door<br>          door num<br>app &lt;-[comm(12B value)]-- door</pre><p>Once the numbers are exchanged, each side calculates keys for itself and the other counterpart:</p><pre>door_key = make_door_key(app_num, door_num)<br>app_key  = make_app_key(app_num, door_num)</pre><p>The communication - referred to as a handshake - is then as follows:</p><pre>app &lt;-[  door(Hello)  ]-- door<br>app --[  app(Welcome) ]-&gt; door<br>app &lt;-[  door(START)  ]-- door</pre><p>Once the handshake is over, additional messages follow - including the EKEY verification command.</p><h3>Impact</h3><p>Although the door/key generation is based on a custom algorithm, it can be retrieved - i.e. from the Android library - and reverse engineered at a relatively low cost. Thus, as long as the malicious attacker is in the effective range of around 15 meters, the traffic can be intercepted and decrypted similarly to the description provided above.<br><br>Traffic interception can be performed at a relatively low cost as well, as - for example - the nRF51822 chip able to sniff BLE communication can be bought at ~5$.<br><br>Once the EKEY value is retrieved, the attacker can perform any actions a legitimate user is able to. This is possible as long as the original application is registered to the device. Moreover, the EKEY value is saved online rendering changing the mobile device insufficient to overcome such an attack.<br><br>In the unlikely scenario of the device not being registered at all (utilising only the mechanical lock), a malicious actor is able to hijack the lock and operate it without any additional interaction. As the mechanical part is dependent on the servomechanisms steering the locking mechanism, this results in a full compromise as well.</p><h3>Mitigation</h3><p>There are no mitigations to the issue at the time of writing. The only way, although inconvenient for the end user, is to pair a mobile device that will be as far from the device as possible and use a physical key/touchpad only.</p><h3>Timeline</h3><table><tbody><tr><td>date</td>
<td>Summary</td>
</tr><tr><td>2019-08-23</td>
<td>F-Secure reports finding to the vendor..</td>
</tr><tr><td>2019-08-23</td>
<td>Vendor replies stating the issues have been forwarded to the appropriate team</td>
</tr><tr><td><span>2019-09-23 </span></td>
<td>V<span>endor acknowledges receiving and initiating action on vulnerabilities reported </span></td>
</tr><tr><td><span>2019-09-24 </span></td>
<td><span>Vendor states that obfuscation will be used as a fix to the aforementioned issue </span></td>
</tr><tr><td><span>2019-09-25</span></td>
<td><span>Vendor states that no firmware update functionality is available and thus the obfuscation will be used to protect users </span></td>
</tr><tr><td> <span>2019-12-10</span></td>
<td><span>F-Secure releases the advisory</span></td>
</tr></tbody></table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/&text=KeyWe Smart Lock unauthorized access and traffic interception" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/&title=KeyWe Smart Lock unauthorized access and traffic interception" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/keywe-smart-lock-unauthorized-access-traffic-interception/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
