<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Samsung S20 - Access External Storage Files</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/samsung-s20-access-external-storage-files/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Samsung S20 - Access External Storage Files</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Samsung phones with Samsung Notes (prior to version 4.2.00.22)</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>Low</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2021-25367</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Storage Security Bypass</td>
          </tr>
        </table>
        
        <h2>Description</h2><p>F-Secure looked into exploiting the Samsung S20 device for Tokyo Pwn2Own 2020. An issue was discovered that would have allowed a rogue application to access any file on the external storage partition without the "External Storage" Android permissions.</p><h2>Technical Details</h2><p>Samsung Notes (com.samsung.android.app.notes) has an exported content provider called "clipdatacontentprovider" that can be used by other applications to download files from the external storage. The issue is due to the class "com.samsung.android.support.senl.nt.base.framework.provider.ClipDataContentProvider" having two methods "onCreate" and "addRoot":</p><pre>public boolean onCreate() {<br>    Context context = getContext();<br>    addRoot("external_files", new File(Environment.getExternalStorageDirectory(), "."));<br>    File[] externalFilesDirs = ContextCompat.getExternalFilesDirs(context, null);<br>    if (externalFilesDirs.length &lt;= 0) {<br>        return true;<br>    }<br>    addRoot("external-files-path", new File(externalFilesDirs[0], ShareCacheHelper.CACHE_PATH));<br>    return true;<br>}</pre><pre>private void addRoot(String str, File file) {<br>    if (!TextUtils.isEmpty(str)) {<br>        try {<br>            mRoots.put(str, file.getCanonicalFile());<br>        } catch (IOException e) {<br>            throw new IllegalArgumentException("Failed to resolve canonical path for " + file, e);<br>        }<br>    } else {<br>        throw new IllegalArgumentException("Name must not be empty");<br>    }<br>}</pre><p>The class relies on the hashMap "mRoots" to keep track of what the content provider's root directories are. In the "onCreate" method, the external storage folder is added as an authorized root directory.</p><p>A rouge application installed on the same device can call this content provider to browse and download files from the External Storage area, bypassing the need to add "EXTERNAL_STORAGE_READ" or "EXTERNAL_STORAGE_WRITE" to the rouge application's manifest. As an example, F-Secure utilized its Android testing application, Drozer, to exploit this issue. The screenshot below shows that Drozer did not have any additional Android permisions (right) and it could not read the file "/storage/emulated/0/yay.jpg" (top left). Meanwhile, the ADB user could read the file "/storage/emulated/0/yay.jpg" (bottom left):</p><p><img class="leftAlone" title="" src="assets/Uploads/_resampled/ResizedImageWzYwMCwyODdd/20210111-184012.png" alt="20210111 184012" width="600" height="287"></p><p>Drozer's "app.provider.download" module can be used to dynamically craft a proper content provider call and communicate with the vulnerable content provider. The below output shows Drozer downloading the file "/storage/emulated/0/yay.jpg" from the external storage using the vulnerable content provider:</p><pre>dz&gt; run app.provider.download content://com.samsung.android.app.notes.clipdatacontentprovider/external_files/yay.jpg /tmp/yay.jpg<br>Written 1932151 bytes<br><br>dz&gt; exit<br>root@324bda543ccd:/# sha1sum /tmp/yay.jpg<br>1e29865dc1b592b06f87cd7d569f93170daa74ed /tmp/yay.jpg</pre><h2>Remedial Action</h2><p>Samsung has released Samsung Notes versionÂ 4.2.00.22 which fixes the issue outlined in this advisory. F-Secure recommends that users upgrade Samsung Notes to at least version 4.2.00.22.</p><h2>Timeline</h2><table>
<thead>
<tr>
<td>Date</td>
<td>Summary</td>
</tr>
</thead>
<tbody>
<tr>
<td>02/11/2020</td>
<td>Issue disclosed to Samsung Mobile Security</td>
</tr>
<tr>
<td>02/11/2020</td>
<td>Issue assigned to a Samsung Security Analyst</td>
</tr>
<tr>
<td>16/12/2020</td>
<td>Samsung confirms the vulnerability and rates it as a low risk issue</td>
</tr>
<tr>
<td>12/01/2021</td>
<td>Follow up sent to Samsung</td>
</tr>
<tr>
<td>13/01/2021</td>
<td>Samsung responds to follow up and says a patch will be released soon</td>
</tr>
<tr>
<td>09/02/2021</td>
<td>Patch released, Samsung initiates process for bug bounty reward</td>
</tr>
<tr>
<td>12/03/2021</td>
<td>Bug Bounty Paid</td>
</tr>
<tr>
<td>25/03/2021</td>
<td>CVE Assigned</td>
</tr>
<tr>
<td>26/03/2021</td>
<td>Advisory Disclosed</td>
</tr>
</tbody>
</table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/&text=Samsung S20 - Access External Storage Files" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/samsung-s20-access-external-storage-files/&title=Samsung S20 - Access External Storage Files" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/samsung-s20-access-external-storage-files/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
