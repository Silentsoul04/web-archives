<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>NVIDIA GeForce Experience LPE</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/nvidia-geforce-experience-lpe/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/nvidia-geforce-experience-lpe/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/nvidia-geforce-experience-lpe/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>NVIDIA GeForce Experience LPE</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>NVIDIA GeForce Experience</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE‑2018‑6261</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Local Privilege Escalation</td>
          </tr>
        </table>
        
        <h1>Description</h1><p>NVIDIA GeForce Experience is a control panel used for configuring features of NVIDIA graphics cards and compatible games.</p><p>Prior to version 3.15 it was found to contain a Local Privilege Escalation vulnerability that would allow a local attacker or malware to escalate their privileges from user to System.</p><h1>Impact</h1><p>An attacker or malicious process could exploit this vulnerability locally to escalate their privileges to NT/SYSTEM.</p><p>The CVSS V3 Vector assigned to this vulnerability is <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H">AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H</a> and a score of 8.8.</p><h1>Cause</h1><p>When enabled, the GeForce Experience Shield GameStream feature causes the 'NVIDA LocalSystem Container' System service to write a log file (C:\ProgramData\NVIDIA Corporation\ShadowPlay\CaptureCore.log); but when this file is created it does not assign any permissions and permitted anyone to modify the file.</p><p style="text-align: center;"><img class="leftAlone" title="" src="assets/Uploads/17.PNG" alt="Intel LPE File Permissions" width="363" height="509"></p><p>A local attacker as any authenticated user can remove the log file and create a symlink allowing for arbitrary file creation (with any name) with System permissions while still allowing any user to modify the file once created. </p><h1>Solution</h1><p>This vulnerability was patched in NVIDIA GeForce Experience 3.15 and now prevents non administrators from writing to the file.</p><h1>Exploitation</h1><h2>Step 1: Disable GameStream</h2><p>In order to remove the file we first need to disable the GameStream feature. This can be done manually via the GeForce Experience settings menu (Shield &gt; GameStream)</p><p style="text-align: center;"><img class="leftAlone" title="" src="assets/Uploads/_resampled/ResizedImageWzYwMCwzNjdd/18.PNG" alt="NVIDIA Games Shield" width="600" height="367"></p><p>From reverse engineering the application it was found that this can also be done by sending a HTTP POST request on localhost to the 'NVIDIA Web Helper' process.</p><pre>Invoke-WebRequest http://127.0.0.1:49887/GameStream/v.1.0/ServerStatus -H @{'X_LOCAL_SECURITY_COOKIE' = 'B594AD049E213E3A910E42755D171130'} -Body '{"streamingEnabled":false}' -Method POST</pre><p>The port number and the value for X_LOCAL_SECURITY_COOKIE can be found in the following file and may change between reboots:</p><p>C:\Users\SomeUser\AppData\Local\NVIDA Corporation\NvNode\nodejs.json</p><pre>{"active":true,"port":50140,"secret":"5A95A58086D016092451471292A88E2D"}</pre><h2>Step 2: Remove Shadowplay folder</h2><p>With the feature disabled we can now remove the file and any other file in the same folder.</p><pre>rm 'C:\ProgramData\NVIDIA Corporation\ShadowPlay\'</pre><h2>Step 3: Create Symlink  </h2><p>Next we need to create a symlink.</p><p>To do this without administrator rights we first need to create a Mount Point such that 'C:\ProgramData\NVIDIA Corporation\ShadowPlay' points to the "\RPC Control\" object directory. Then create a Symlink such that "\RPC Control\CaptureCore.log" points to "\\?\C:\Program Files\NVIDIA Corporation\NvContainer\nvaudcap64v.dll"</p><p>A simple way to perform this is using James Forshaw's symboliclink-testing-tools (<a href="https://github.com/google/symboliclink-testing-tools">https://github.com/google/symboliclink-testing-tools</a>)</p><pre>CreateSymlink.exe "C:\ProgramData\NVIDIA Corporation\ShadowPlay\CaptureCore.log" "C:\Program Files\NVIDIA Corporation\NvContainer\nvaudcap64v.dll"</pre><h2>Step 4: Enable GameStream</h2><p>To trigger file creation we need to enable the GameStream feature again. We can either do this via the settings menu manually or via a POST request:</p><pre>Invoke-WebRequest http://127.0.0.1:49887/GameStream/v.1.0/ServerStatus -H @{'X_LOCAL_SECURITY_COOKIE' = 'B594AD049E213E3A910E42755D171130'} -Body '{"streamingEnabled":true}' -Method POST</pre><p>This action will try to create and write the log file "C:\ProgramData\NVIDIA Corporation\ShadowPlay\CaptureCore.log" but this will be redirected to create the file "C:\Program Files\NVIDIA Corporation\NvContainer\nvaudcap64v.dll" without any permissions set.</p><p style="text-align: center;"><img class="leftAlone" title="" src="assets/Uploads/19.PNG" alt="Highjack DLLL" width="363" height="509"></p><h2>Step 5: Modify DLL</h2><p>The contents of the DLL can now be modified to contain malicious code that will be executed as system when it is loaded by 'NVIDIA LocalSystem Container'.</p><p>In this PoC we built a simple DLL that will spawn cmd.exe when loaded.</p><h2>Step 6: Disable/Enable GameStream</h2><p>This DLL is loaded whenever the GameStream feature is started so we first disable the GameSteam feature (Step 1) and then enable it again (Step 4).</p><p>We should also remove our symlink before re-enabling the service again.</p><p>When the GameStream feature is enabled it causes the 'NVIDIA LocalSystem Container' service to load the malicious DLL and execute malicious code as System within the processes of that service.</p><p style="text-align: center;"><img class="leftAlone" title="" src="assets/Uploads/_resampled/ResizedImageWzYwMCwzNDNd/20.PNG" alt="System Shell" width="600" height="343"></p><h1 style="text-align: left;">Timeline</h1><table style="width: 825px; height: 204px;"><tbody><tr><td>Date</td>
<td>Summary</td>
</tr><tr><td>2018-06-18</td>
<td>Informed NVIDIA Security of vulnerability with PoC exploit PS script</td>
</tr><tr><td>2018-06-18</td>
<td>NVIDIA PSRT Assigned a case number</td>
</tr><tr><td>2018-06-26</td>
<td>NVIDIA PSRT Confirmed the case was under review</td>
</tr><tr><td>2018-06-29</td>
<td>NVIDIA PSRT Confirmed the vulnerability</td>
</tr><tr><td>2018-09-27</td>
<td>NVIDIA PSRT Patched the vulnerability and assigned a CVE</td>
</tr></tbody></table><h3>Further Information</h3><p><a href="https://nvidia.custhelp.com/app/answers/detail/a_id/4725/~/security-bulletin%3A-nvidia-geforce-experience---september-2018">https://nvidia.custhelp.com/app/answers/detail/a_id/4725/~/security-bulletin%3A-nvidia-geforce-experience---september-2018</a></p><p><a href="https://github.com/googleprojectzero/symboliclink-testing-tools">https://github.com/googleprojectzero/symboliclink-testing-tools</a></p><p> </p>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/nvidia-geforce-experience-lpe/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/nvidia-geforce-experience-lpe/&text=NVIDIA GeForce Experience LPE" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/nvidia-geforce-experience-lpe/&title=NVIDIA GeForce Experience LPE" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/nvidia-geforce-experience-lpe/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
