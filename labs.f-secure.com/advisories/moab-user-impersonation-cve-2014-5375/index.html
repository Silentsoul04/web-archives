<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Moab User Impersonation [CVE-2014-5375]</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/moab-user-impersonation-cve-2014-5375/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/moab-user-impersonation-cve-2014-5375/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/moab-user-impersonation-cve-2014-5375/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Moab User Impersonation [CVE-2014-5375]</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Moab</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>CVE-2014-5375</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Moab User Impersonation</td>
          </tr>
        </table>
        
        <p>It is possible to submit jobs to Moab as arbitrary users due to insufficient authentication checks during the submission of a job to the Moab server.</p>
<dl><dt>Software</dt><dd>Moab</dd><dt>Affected Versions</dt><dd>All current versions of Moab. However, the impact is limited in Moab 7.2.9 and Moab 8</dd><dt><span class="caps">CVE</span> Reference</dt><dd><span class="caps">CVE</span>-2014-5375</dd><dt>Authors</dt><dd>John Fitzpatrick &amp; Luke Jennings</dd><dt>Severity</dt><dd>High Risk</dd><dt>Vendor</dt><dd>Adaptive Computing</dd><dt>Vendor Response</dt><dd>Updates in Moab 7.2.9 and Moab 8 provide some mitigations</dd></dl><h3>Description</h3>
<p>It is possible to submit jobs to Moab as arbitrary users due to insufficient authentication checks during the submission of a job to the Moab server.</p>
<h3>Impact</h3>
<p>Users are able to submit jobs as arbitrary users. In environments that permit it this could allow job execution as root.</p>
<h3>Cause</h3>
<p>Moab does not sufficiently validate the job submissions against its intended user ID values.</p>
<h3>Solution</h3>
<p>An upgrade to Moab 7.2.9 or Moab 8 prevents direct exploitation of this issue (further details are provided in the “Technical Details” section below). In these versions jobs submitted in this manner enter a held state, this is flagged as a known issue by Adaptive (<span class="caps">MOAB</span>-7478):</p>
<p><em>“Jobs submitted with invalid credentials are put in a held state, instead of rejected, until the administrator can respond. The checkjob command gives administrators further information regarding why the job is held. Blindly assuming that all held jobs should in fact be running <span class="caps">RIGHT</span> <span class="caps">NOW</span> is not only unsafe, but circumvents intentional Moab policies and workflow. An administrator should exercise care when resolving held jobs”.</em></p>
<p>Administrators should be aware that attackers can control the &lt;UserID&gt; value which provides them control over the user specified within the checkjob. <span class="caps">MWR</span> would recommend that Adaptive make use of the “actor” value passed to Moab, as the controls introduced in 7.2.9 and 8 prevent manipulation of this value.</p>
<h3>Technical Details</h3>
<p>Moab is a workload manager used in High Performance Computing (<span class="caps">HPC</span>) environments. In a typical environment a user submits their jobs to the Moab server for it to handle the workload. Moab communication makes use of an <span class="caps">XML</span> based protocol. An example message showing a job submission is shown below:</p>
<pre>&lt;Envelope component="ClusterScheduler" count="1" name="moab" type="nonblocking" version="8.0.beta.2"&gt;
  &lt;Signature&gt;
    &lt;DigestValue&gt;7v49VzAlbyNQ4O3VChCus+v2LeE=&lt;/DigestValue&gt;
    &lt;SignatureValue&gt;QG13cmxhYnMgRWFzdGVyIEVnZyE=&lt;/SignatureValue&gt;
  &lt;/Signature&gt;
  &lt;Body actor="test" timestamp="1408488412"&gt;
    &lt;Request action="submit" actor="test" cmdline="\STARTmsub"&gt;
      &lt;Object&gt;job&lt;/Object&gt;
      &lt;job&gt;
        &lt;Owner&gt;test&lt;/Owner&gt;
        &lt;UserId&gt;test&lt;/UserId&gt;
        &lt;GroupId&gt;test&lt;/GroupId&gt;
        &lt;InitialWorkingDirectory&gt;/home/test&lt;/InitialWorkingDirectory&gt;
        &lt;UMask&gt;2&lt;/UMask&gt;
        &lt;Executable&gt;/usr/bin/id&lt;/Executable&gt;
        &lt;SubmitLanguage&gt;PBS&lt;/SubmitLanguage&gt;
        &lt;SubmitString&gt;\START/usr/bin/id\0a\0a&lt;/SubmitString&gt;
      &lt;/job&gt;
    &lt;/Request&gt;
  &lt;/Body&gt;
&lt;/Envelope&gt;</pre>
<p>Within this message users are specified in multiple locations, these are highlighted in bold in the message above. In versions of moab prior to Moab 8 there are two instances of the “actor” value specified. In order for mauth to sign a message the actor specified within the &lt;Request&gt; tag must match the user calling mauth. It is not necessary for the actor value within the &lt;Body&gt; tag to match the calling user.</p>
<p>In addition to checks at the mauth level the server will perform its own checks. The server ensures that the &lt;Owner&gt; matches the user specified within the &lt;Body&gt; actor value. If either differs an error (code 999 – invalid credentials specified for submitted job) is returned by the server and the job rejected.</p>
<p>Since the actor value within the body tag is not verified by mauth, and this actor value is also the one against which the server checks the &lt;Owner&gt; tag, it is possible to smuggle through jobs to the server with an arbitrary user specified in each of these values. The user under which the job is queued by Moab is the user specified within the &lt;UserId&gt; tag. Whilst it is possible to impersonate a user by changing only this value, doing so appears to impede communication between Moab and a workload manager, on <span class="caps">TORQUE</span> this results in the job entering a BatchHold state where it will not execute. When the Body.actor value, the &lt;Owner&gt; and the &lt;UserId&gt; value are altered (but the Request.actor value remains legitimate to facilitate signing) it is possible to impersonate any user.</p>
<p>The example above describes this process when impersonating users during job submission. Moab also provides a means to reconfigure the server and a similar approach can be adopted to impersonate root and perform server reconfiguration.</p>
<p>In Moab 8 only a single actor value is contained within the messages and is used by both mauth and by the Moab server. This prevents manipulation of the &lt;Owner&gt; value during job submission. It remains possible to alter the &lt;UserId&gt; value and submit jobs in Moab 8 (as described above), although in a typical Moab+TORQUE configuration this does cause the job to enter a BatchHold state (other resource managers have not been tested).</p>
<p>Whilst components of this issue remain outstanding, upgrading to 7.2.9 or Moab 8 appears to mitigate direct exploitation of the issue.</p>
<h3>Detailed Timeline</h3>
<table><tbody><tr><td>Date</td>
<td>Summary</td>
</tr><tr><td>2014-01-21</td>
<td>Detailed vulnerability information provided to Adaptive</td>
</tr><tr><td>2014-09-01</td>
<td>Full advisory provided to Adaptive</td>
</tr><tr><td>2014-09-08</td>
<td>Release of advisory to <span class="caps">HPC</span> community</td>
</tr><tr><td>2014-09-25</td>
<td>Public release of advisory</td>
</tr></tbody></table><p>http://labs.mwrinfosecurity.com</p>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/moab-user-impersonation-cve-2014-5375/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/moab-user-impersonation-cve-2014-5375/&text=Moab User Impersonation [CVE-2014-5375]" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/moab-user-impersonation-cve-2014-5375/&title=Moab User Impersonation [CVE-2014-5375]" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/738/original/mwri_moab-user-impersonation-CVE-2014-5375_2014-09-25.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/moab-user-impersonation-cve-2014-5375/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
