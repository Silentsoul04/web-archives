<!DOCTYPE html>
<html lang="en-US">
<head>
    <base href="https://labs.f-secure.com/"><!--[if lte IE 6]></base><![endif]-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="x-subsite-id" content="1" />

    <title>Metasploit Pro Root Privilege Escalation</title>

    <link rel="stylesheet" href="https://labs.f-secure.com/themes/mwr/css/style.css?t=20200715">
    <link rel="stylesheet" href="https://labs.f-secure.com/themes/labs/css/style.css?t=20200715">

    <meta name="description" content="">
    <link rel="canonical" href="https://labs.f-secure.com/advisories/metasploit-pro-root-privilege-escalation/">
    <meta name="robots" content="NOODP,index,follow">

    

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <meta name="format-detection" content="telephone=no">
    
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="F-Secure Labs">
    <meta property="og:url" content="https://labs.f-secure.com/advisories/metasploit-pro-root-privilege-escalation/">
    
    <meta property="og:locale" content='en_GB'>
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">

  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})
    (window,document,'script','dataLayer','GTM-KD9T85H');
  </script>
  <meta name="google-site-verification" content="jqRTM8I_uI-jDIu1ITng14jD-3iJy0l3TTCIl2I-BIo" />
<link rel="stylesheet" type="text/css" href="/themes/labs/css/style.css?m=1600760392" />
</head>
<body class="BlogPost" dir="ltr">

    <header class="head menu-opened" id="top">
	<div class="container">
		<div class="col12">
			<div class="logo">
				<a href="/">F-Secure</a>
			</div>
		    <a href="/advisories/metasploit-pro-root-privilege-escalation/#nav" class="btn-menu">Menu</a>

<nav class="main-nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul>
        
            <li class="section nav-advisories"><a href="/advisories/" title="Advisories">Advisories</a></li>
        
            <li class="link nav-blog"><a href="/blog/" title="/var/log/messages">/var/log/messages</a></li>
        
            <li class="link nav-publications"><a href="/publications/" title="Publications">Publications</a></li>
        
            <li class="link nav-tools"><a href="/tools/" title="Tools">Tools</a></li>
        
            <li class="link nav-archive"><a href="/archive/" title="Archive">Archive</a></li>
        
        <li class="nav-careers"><a href="https://www.f-secure.com/en/web/about_global/careers/job-openings">Careers</a></li>
    </ul>
</nav>

		</div>
	</div>
</header>


    <div class="wrapper">

        <section class="section">
  <div class="page-title">
    <div class="container">
      <span class="content-type"></span>
      <h1>Metasploit Pro Root Privilege Escalation</h1>
      
      
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="col8">
      <div class="blog-post">
        
        <table>
          <tr>
            <td>Product</td>
            <td>Metasploit Pro</td>
          </tr>
          <tr>
            <td>Severity</td>
            <td>High</td>
          </tr>
          <tr>
            <td>CVE Reference</td>
            <td>N/A</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>Metasploit Pro – Privilege Escalation (root)</td>
          </tr>
        </table>
        
        <p>Vulnerabilities in Metasploit Pro were found that allowed users to escalate their privileges, from the web interface, to a privileged local operating system user.</p>
<dl><dt>Software</dt><dd>Metasploit Pro</dd><dt>Affected Versions</dt><dd>&lt;v4.9.0</dd><dt><span class="caps">CVE</span> Reference</dt><dd>N/a</dd><dt>Authors</dt><dd>Ben Campbell, <span class="caps">MWR</span> Labs</dd><dt>Severity</dt><dd>High <span class="caps">CVSS</span> V2 8.5 <span class="caps">CVSS</span> v2 Vector (AV:N/AC:M/Au:S/C:C/I:C/A:C)</dd><dt>Vendor</dt><dd>Rapid7</dd><dt>Vendor Response</dt><dd>Fixed</dd></dl><h3>Description</h3>
<p>Metasploit Pro is a toolkit for the exploitation of other machines. A number of modules within Metasploit make unsafe calls using the system() function as they do not validate user input. This vulnerability does not affect the Framework as any user who has access via the Remote Procedure Call mechanism is trusted to call system commands. The Community edition only has a single user, the administrator, who can enable ‘allow_console_access’ to get raw access to the console and run commands. Metasploit Pro provides a multi user model which is the only trust model where this finding is an issue.</p>
<h3>Impact</h3>
<p>Successful exploitation allows remote code execution on the framework host as the root user.</p>
<h3>Cause</h3>
<p>This issue is caused by a failure to validate user supplied input in module options.</p>
<h3>Interim Workaround</h3>
<p>Remove the modules/auxiliary/scanner/http/sqlmap.rb and modules/post/windows/screen_spy.rb</p>
<h3>Solution</h3>
<p>Upgrade to v4.9.0.</p>
<h3>Technical Details</h3>
<p>This issue can be replicated by running the Windows post module screen_spy module against a session with the following settings:</p>
<p>VIEW_CMD: `touch /tmp/mwr`</p>
<p>The vulnerable code:</p>
<p>77 cmd = “#{datastore[‘VIEW_CMD’]}#{screenshot}”</p>
<p>…</p>
<p>108 system(cmd) if cmd</p>
<p>There are two paths in the sqlmap module. Specify an additional command line option, <span class="caps">OPT</span>, —eval which will execute arbitrary code:</p>
<p>67 opts = datastore[‘OPTS’]</p>
<p>…</p>
<p>90 if opts</p>
<p>91 cmd &lt;&lt; opts</p>
<p>92 end</p>
<p>…</p>
<p>101 system(*cmd</p>
<p>Or point the module to an sqlmap.py file of your choice with the SQLMAP_PATH option:</p>
<p>59 sqlmap = File.join(datastore[‘SQLMAP_PATH’], ‘sqlmap.py’)</p>
<p>…</p>
<p>96 cmd = [ sqlmap ]</p>
<p>…</p>
<p>101 system(*cmd)</p>
<h3>Detailed Timeline</h3>
<table><tbody><tr><td>Date</td>
<td>Summary</td>
</tr><tr><td>15/02/2014</td>
<td>Issue reported to Rapid7</td>
</tr><tr><td>15/02/2014</td>
<td>Acknowledgement by Rapid7, R7 issue number assigned: R7-2014-05</td>
</tr><tr><td>22/02/2014</td>
<td>Update from Rapid7 estimated patch in 2 weeks</td>
</tr><tr><td>03/03/2014</td>
<td>Update from Rapid7 with suggested fix</td>
</tr><tr><td>25/03/2014</td>
<td>Fix landed to framework</td>
</tr><tr><td>26/03/2014</td>
<td>v4.9.0 released</td>
</tr><tr><td>28/03/2014</td>
<td>Rapid7 Publish Advisory: https://community.rapid7.com/community/metasploit/<br> blog/2014/03/28/r7-2014-05-vulnerability-in-metasploit-modules-fixed</td>
</tr></tbody></table>
      </div>
      <div class="social-share">
        <p><span class="content-type">Share</span></p>
        <ul class="social">
  <li class="facebook"><a href="http://www.facebook.com/sharer.php?u=https://labs.f-secure.com/advisories/metasploit-pro-root-privilege-escalation/" target="_blank">Share on Facebook</a></li>
  <li class="twitter"><a href="https://twitter.com/share?url=https://labs.f-secure.com/advisories/metasploit-pro-root-privilege-escalation/&text=Metasploit Pro Root Privilege Escalation" target="_blank">Share on LinkedIn</a></li>
  <li class="linkedin"><a href="http://www.linkedin.com/shareArticle?url=https://labs.f-secure.com/advisories/metasploit-pro-root-privilege-escalation/&title=Metasploit Pro Root Privilege Escalation" target="_blank">Share on Twitter</a></li>
</ul>

      </div>
    </div>
    <div class="col4">
      
      <a href="/assets/663/original/mwri_metasploit-pro-privilege-escalation_2014-05-14.pdf" class="flex-container__box">
            <span class="content-type">Download</span>
            
            <h3 class="flex-container__box-title">Download the advisory here.</h3>
            
      </a>
      

      
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="col12">
        <p>&nbsp;</p>
      </div>
    </div>
  </section>


    </div>

    <footer class="foot">
	<div class="container">
    <div class="footer-flex-wrap">
     <p class="logo"><img src="https://labs.f-secure.com//themes/labs/img/fs-labs-logo-white.svg" alt="F-Secure" width="180" height="60"></p>
      <ul class="top-menu">
        <li><a href="/advisories/metasploit-pro-root-privilege-escalation/#top" class="btn-gototop">Top</a></li>
        
        <li class="link"><a href="https://www.f-secure.com/en/consulting/contact">Contact</a></li>
        
        
      </ul>
   </div>
   <hr/>
    <div class="col5 suf1 foot-about">
      <p>F-Secure provides specialist advice and solutions in all areas of cyber security, from professional and managed services, through to developing commercial and open source security tools.  </p>
    </div>
    <div class="col3">
      <ul class="footer-list no-margin">
        
        <li><a href="/publications/ti-report-lazarus-group-cryptocurrency-vertical/">Threat Intelligence Report: Lazarus Group Campaign Targeting the Cryptocurrency Vertical</a></li>
        
        <li><a href="/publications/the-fake-cisco/">The Fake Cisco</a></li>
        
        <li><a href="/publications/u-booting-securely/">U-Booting securely</a></li>
        
      </ul>
    </div>
    <div class="col3">
     <ul class="footer-list">
      
      <li><a href="/blog/prelude-to-ransomware-systembc/">Prelude to Ransomware: SystemBC</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-3/">Attack Detection Fundamentals 2021: Azure - Lab #3</a></li>
      
      <li><a href="/blog/attack-detection-fundamentals-2021-azure-lab-2/">Attack Detection Fundamentals 2021: Azure - Lab #2</a></li>
      
    </ul>
  </div>
</div>
<div class="end">
 <div class="container">
  <hr/>
  <div class="footer-flex-wrap">
   <p class="copyright">Copyright &copy; 2021 F-Secure</p>
    <ul class="social">
      
      <li class="linkedin for-footer"><a href="https://www.linkedin.com/showcase/28493188" target="_blank">Connect with us on LinkedIn</a></li>
      
      
      <li class="twitter for-footer"><a href="https://twitter.com/fsecurelabs" target="_blank">Follow us on Twitter</a></li>
      
      
      <li class="github for-footer"><a href="https://github.com/fsecurelabs" target="_blank">Follow us on GitHub</a></li>
      
    </ul>
 </div>
</div>
</div>
</footer>

    <script src="/themes/mwr/js/min/jquery-3.5.1.min.js" id="jqueryscript"></script>

    
    <script src="/themes/mwr/js/min/slides.min.js"></script>
    

    <script src="/themes/mwr/js/min/scripts.js?20190917" id="pagescripts"></script>

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "F-Secure Labs",
      "url" : "https://labs.f-secure.com",
      "logo" : "https://labs.f-secure.com/themes/labs/img/fs-labs-logo-white.svg",
      "sameAs" : [
          "https://twitter.com/fsecurelabs",
          "https://www.linkedin.com/showcase/28493188"],
      "contactPoint" : [
        { "@type" : "ContactPoint",
          "telephone" : "+441256300920",
          "contactType" : "customer service"
        } ]
    }
    </script>
</body>
</html>
